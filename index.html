<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Codelab View - #ruflood</title>
    <style>
        :root { --primary: #0dbd8b; --bg: #15191e; --panel: #181d23; --text: #f3f4f5; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        #sidebar { width: 200px; background: var(--panel); border-right: 1px solid #2e3641; display: flex; flex-direction: column; padding: 15px; flex-shrink: 0; }
        .step { padding: 10px; border-radius: 5px; cursor: pointer; font-size: 0.85em; margin-bottom: 5px; color: #a9b2bc; }
        .step.active { background: rgba(13, 189, 139, 0.1); color: var(--primary); font-weight: bold; border-left: 3px solid var(--primary); }
        #main { flex-grow: 1; display: flex; flex-direction: column; padding: 20px; overflow-y: auto; position: relative; }
        .content-section { display: none; padding-bottom: 80px; }
        .content-section.active { display: block; }
        pre { background: #000; padding: 15px; border-radius: 8px; overflow-x: auto; color: #e6db74; font-family: monospace; font-size: 0.85em; border: 1px solid #394352; white-space: pre-wrap; }
        #footer { position: fixed; bottom: 0; right: 0; width: calc(100% - 230px); background: var(--bg); padding: 15px; border-top: 1px solid #2e3641; box-sizing: border-box; }
        input { width: 100%; background: #21262c; border: 1px solid #394352; color: #fff; padding: 12px; border-radius: 8px; outline: none; }
        input:focus { border-color: var(--primary); }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3 style="color: var(--primary); font-size: 1em; margin-top: 0;">CODELAB</h3>
        <div class="step active" onclick="goStep(1)">1. Introducción</div>
        <div class="step" onclick="goStep(2)">2. Ver Código Fuente</div>
        <div class="step" onclick="goStep(3)">3. Usuarios Matrix</div>
    </div>

    <div id="main">
        <div id="step1" class="content-section active">
            <h1>Bienvenido a #ruflood</h1>
            <p>Este es un visualizador interactivo para la sala <b>#ruflood:unredacted.org</b>.</p>
            <p>Usa el menú lateral para explorar las funciones del widget.</p>
        </div>

        <div id="step2" class="content-section">
            <h1>Código Fuente</h1>
            <p>Código directo desde GitHub:</p>
            <pre id="code-box">Cargando código...</pre>
        </div>

        <div id="step3" class="content-section">
            <h1>Base de Datos</h1>
            <p>Usuarios configurados para autocompletar:</p>
            <ul id="user-list"></ul>
        </div>
    </div>

    <div id="footer">
        <input type="text" id="chatInput" placeholder="Prueba el tabulador: escribe @ y pulsa TAB..." autocomplete="off">
    </div>

    <script>
        const usuarios = ["@admin:unredacted.org", "@mariaspy8:unredacted.org", "@ivan:unredacted.org", "@sergei:unredacted.org"];
        
        function goStep(n) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            document.querySelectorAll('.step')[n-1].classList.add('active');
            if(n === 2) fetchCode();
            if(n === 3) renderUsers();
        }

        function renderUsers() {
            const list = document.getElementById('user-list');
            list.innerHTML = usuarios.map(u => `<li>${u}</li>`).join('');
        }

        async function fetchCode() {
            const codeBox = document.getElementById('code-box');
            try {
                const r = await fetch('[https://raw.githubusercontent.com/mariaspy8/matrix-tab-widget-./main/index.html](https://raw.githubusercontent.com/mariaspy8/matrix-tab-widget-./main/index.html)');
                const t = await r.text();
                codeBox.textContent = t;
            } catch(e) { codeBox.textContent = "Error cargando el código desde GitHub."; }
        }

        document.getElementById('chatInput').addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                const words = e.target.value.split(" ");
                const last = words[words.length - 1];
                if (last.startsWith('@')) {
                    const match = usuarios.find(u => u.toLowerCase().startsWith(last.toLowerCase()));
                    if (match) {
                        words[words.length - 1] = match;
                        e.target.value = words.join(" ") + " ";
                    }
                }
            }
        });
    </script>
</body>
</html>
