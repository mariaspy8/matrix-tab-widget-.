<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabulador #ruflood</title>
    <style>
        body { background: #15191e; color: #f3f4f5; font-family: sans-serif; margin: 0; padding: 15px; display: flex; flex-direction: column; height: 100vh; box-sizing: border-box; }
        #header { font-size: 0.9em; color: #0dbd8b; margin-bottom: 10px; border-bottom: 1px solid #394352; padding-bottom: 5px; font-weight: bold; }
        #display { flex-grow: 1; background: #181d23; border: 1px solid #2e3641; padding: 15px; overflow-y: auto; margin-bottom: 15px; border-radius: 8px; font-size: 0.95em; }
        input { width: 100%; background: #21262c; border: 1px solid #394352; color: #ffffff; padding: 12px; border-radius: 8px; outline: none; }
        input:focus { border-color: #0dbd8b; }
        .user-msg { color: #0dbd8b; font-weight: bold; }
        .system-msg { color: #a9b2bc; font-style: italic; font-size: 0.85em; }
    </style>
</head>
<body>

    <div id="header">Matrix Widget: #ruflood:unredacted.org</div>
    
    <div id="display">
        <div class="system-msg">Подключено к #ruflood. Escribe @ y pulsa TAB.</div>
    </div>
    
    <div style="position: relative;">
        <input type="text" id="chatInput" placeholder="Escribe @usuario y pulsa Tab..." autocomplete="off">
    </div>

    <script src="https://unpkg.com/matrix-widget-api@0.1.0/dist/api.js"></script>
    <script>
        const widgetApi = new matrixWidgetApi.WidgetApi();
        const chatInput = document.getElementById('chatInput');
        const display = document.getElementById('display');

        const usuariosRu = [
            "@admin:unredacted.org", 
            "@mariaspy8:unredacted.org",
            "@ivan:unredacted.org", 
            "@sergei:unredacted.org", 
            "@unredacted_bot:unredacted.org"
        ];

        widgetApi.requestCapabilities(['org.matrix.msc2762.receive.event', 'm.room.message']);
        widgetApi.start();

        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault(); 
                const words = chatInput.value.split(" ");
                const lastWord = words[words.length - 1];
                if (lastWord.startsWith('@')) {
                    const match = usuariosRu.find(u => u.toLowerCase().startsWith(lastWord.toLowerCase()));
                    if (match) {
                        words[words.length - 1] = match;
                        chatInput.value = words.join(" ") + " ";
                    }
                }
            }
            if (e.key === 'Enter' && chatInput.value.trim() !== "") {
                display.innerHTML += `<div><span class="user-msg">Вы:</span> ${chatInput.value}</div>`;
                chatInput.value = "";
                display.scrollTop = display.scrollHeight;
            }
        });
    </script>
</body>
</html>
